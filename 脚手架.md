## 研发项目痛点分析

1. 创建项目+通用代码

   > 创建醒目/组件时，存在大量重复代码拷贝：快速复用已有沉淀

   1. 埋点
   2. HTTP请求
   3. 工具方法
   4. 组件库

2. git操作

   > 协同开发时，由于git操作不规范，导致分支混乱，操作耗时：制定标准的git操作规范并集成到脚手架

   1. 创建仓库
   2. 代码冲突
   3. 远程diamagnetic同步
   4. 创建版本
   5. 发布打tag

3. 构建+发布上线

   > 发布上线耗时，而且容易出现各种错误：制定标准的上线流程和规范并集成到脚手架

   1. 依赖安装和构建
   2. 资源上传CDN
   3. 域名绑定
   4. 测试/正式服务器



## 需求分析

- 通用的研发脚手架
- 通用的项目/组件创建能力
  - 模板支持定制，定制后能够发布生效
  - 模板支持快速接入，极低的接入成本
- 通用的项目/组件发布能力
  - 发布过程自动完成标准的git操作
  - 发布成功后自动删除开发分支并创建tag
  - 发布后自动完成云构建、OSS上传、CDN上传、域名绑定
  - 发布过程支持测试/正式服务器两种模式

![](D:\文档\技术梳理\img\脚手架架构图.png)

## 本地link标准流程

#### 连接本地脚手架

```bash
cd your-cli-dir
npm link
```



#### 连接本地库文件

```bash
cd your-lib-dir
npm link
cd your-cli-dir
npm link your-lib
```



#### 取消连接本地库文件

```bash
cd your-lib-dir
npm unlink
cd your-cli-dir
# link 存在
npm unlink your-lib
# link 不存在
rm -rf node_modules
npm install -s your-lib
```



#### 理解 npm link

- npm link your-lib ： 将当前项目中 node_modules 下指定的库文件连接到 node 全局 node_modules 下的库文件
- npm link ： 将当前项目连接到node 全局 node_modules 中作为一个库文件， 并解析bin配置创建可执行文件



#### 理解 npm unlink

- npm unlink : 将当前项目从node 全局 node_modules 中移除
- npm unlink your-lib ： 将当前项目中的库文件依赖移除



## 脚手架拆包策略

- 核心流程 core
- 命令 commands
  - 初始化
  - 发布
  - 清除缓存
- 模型层 models
  - Command命令
  - Project项目
  - Componen组件
  - Npm模块
  - Git仓库
- 支撑模块utils
  - Git操作
  - 云构建
  - 工具方法
  - API 请求
  - Git API

#### 拆分策略

	- 核心模块：core
	- 命令模块： commands
	- 模型模块：models
	- 工具模块：utils



## core 模块技术方案

- 准备阶段
- 命令注册
- 命令执行



#### 涉及技术点

- 核心库
  - import-local
  - commander
- 工具库
  - npmlog 打印日志
  - fs-extra 封装的文件操作
  - semver 版本比对
  - colors 打印不同颜色文本
  - user-home 拿到用户主目录
  - dotenv 获取环境变量
    - 加载用户环境变量 从 .env 文件读取
  - root-check root账户检查和自动降级
    - path-exists 检查root目录是否存在
  - minimist   args的参数解析
  - url-join  帮助拼接url字符串
  - 



























